<nz-page-header nzBackIcon>
    <nz-page-header-title>DANH S√ÅCH D·ª∞ √ÅN</nz-page-header-title>
    <nz-page-header-subtitle>Danh s√°ch c√°c d·ª± √°n</nz-page-header-subtitle>
    <nz-page-header-extra>
        <nz-space>
            <input *nzSpaceItem nz-input placeholder="T√¨m ki·∫øm nhanh" [(ngModel)]="filter.keyWord"
                (keydown.enter)="search()" />

            <button *nzSpaceItem nz-button (click)="reset()">
                <nz-icon nzType="sync" nzTheme="outline" />
            </button>

            <button *nzSpaceItem nz-button (click)="search()">
                <nz-icon nzType="search" nzTheme="outline" />
            </button>

            <button *nzSpaceItem nz-button nzType="primary" (click)="openCreate()">
                <nz-icon nzType="plus" nzTheme="outline" /> Th√™m m·ªõi
            </button>
        </nz-space>
    </nz-page-header-extra>
    <nz-page-header-content>
        <nz-table #list nzBordered [nzData]="data.data" nzSize="small" [nzFrontPagination]="false"
            [nzScroll]="{ y: 'calc(100vh - 226px)' }">
            <thead>
                <tr>
                    <th nzWidth="40px" [nzChecked]="checked" [nzIndeterminate]="indeterminate"
                        (nzCheckedChange)="onAllChecked($event)"></th>
                    <th>M√£ d·ª± √°n</th>
                    <th>T√™n d·ª± √°n</th>
                    <th>Lo·∫°i d·ª± √°n</th>
                    <th>L√£nh ƒë·∫°o ph·ª• tr√°ch</th>
                    <th>ƒê∆°n v·ªã ph·ª• tr√°ch</th>
                    <th nzAlign="center" nzWidth="160px">Ng√†y b·∫Øt ƒë·∫ßu</th>
                    <th nzAlign="center" nzWidth="160px">Ng√†y k·∫øt th√∫c</th>
                    <th nzAlign="center"> Giai ƒëo·∫°n</th>
                    <th nzAlign="center"> Tr·∫°ng th√°i</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let item of list.data; trackBy: trackById">
                    <td [nzChecked]="setOfCheckedId.has(item.id)" (nzCheckedChange)="onItemChecked(item.id, $event)">
                    </td>
                    <td><a (click)="openDetailProject(item.id)">{{ item.code }}</a></td>
                    <td>{{ item.name }}</td>
                    <td>{{ item.loaiDuAn }}</td>
                    <td>{{ item.lanhDaoPhuTrach }}</td>
                    <td>{{ item.donViPhuTrach }}</td>

                    <td nzAlign="center">{{ item.startDate | date: 'dd/MM/yyyy HH:mm' }}</td>
                    <td nzAlign="center">{{ item.endDate | date: 'dd/MM/yyyy HH:mm' }}</td>
                    <td nzAlign="center">{{ item.giaiDoan }}</td>
                    <td nzAlign="center">{{ item.trangThai }}</td>

                </tr>
            </tbody>
        </nz-table>
    </nz-page-header-content>
</nz-page-header>
<div class="paging-container">
    <div>T·ªïng {{data.totalRecord}} b·∫£n ghi</div>
    <nz-pagination [nzPageIndex]="data.currentPage" [nzTotal]="data.totalRecord" nzShowSizeChanger
        [nzPageSize]="data.pageSize" nzShowQuickJumper (nzPageIndexChange)="pageIndexChange($event)"
        (nzPageSizeChange)="pageSizeChange($event)">
    </nz-pagination>
</div>

<nz-drawer [nzWidth]="'50%'" [nzClosable]="false" [nzVisible]="visible" nzPlacement="right" [nzMask]="true"
    [nzExtra]="extra" [nzTitle]="'T·∫†O M·ªöI D·ª∞ √ÅN'" (nzOnClose)="close()" [nzBodyStyle]="{ padding: '0px' }">
    <ng-container *nzDrawerContent>

        <div nz-row [nzGutter]="12">
            <div nz-col class="gutter-row" [nzSpan]="12">
                <div class="inner-box">
                    <div class="project-info">
                        <label>M√£ d·ª± √°n</label>
                        <input nz-input [(ngModel)]="dto.code" class="space-control" />

                        <label>T√™n d·ª± √°n</label>
                        <input nz-input [(ngModel)]="dto.name" class="space-control" />

                        <label>Lo·∫°i d·ª± √°n</label>
                        <nz-select nzShowSearch nzAllowClear [(ngModel)]="dto.loaiDuAn" class="space-control">
                            <nz-option *ngFor="let i of loaiDuAn" [nzLabel]="i.name" [nzValue]="i.code"></nz-option>
                        </nz-select>

                        <label>ƒê∆°n v·ªã ph·ª• tr√°ch</label>
                        <nz-select nzShowSearch nzAllowClear [(ngModel)]="dto.donViPhuTrach" class="space-control"
                            (ngModelChange)="onChangeOrg($event)">
                            <nz-option *ngFor="let i of lstOrganize" [nzLabel]="i.name" [nzValue]="i.id"></nz-option>
                        </nz-select>

                        <label>L√£nh ƒë·∫°o ph·ª• tr√°ch</label>
                        <nz-select nzShowSearch nzAllowClear [(ngModel)]="dto.lanhDaoPhuTrach" class="space-control">
                            <nz-option *ngFor="let i of lstAccount" [nzLabel]="i.fullName"
                                [nzValue]="i.userName"></nz-option>
                        </nz-select>

                        <label>PM d·ª± √°n</label>
                        <nz-select nzShowSearch nzAllowClear [(ngModel)]="dto.pmDuAn" class="space-control">
                            <nz-option *ngFor="let i of lstAccount" [nzLabel]="i.fullName"
                                [nzValue]="i.userName"></nz-option>
                        </nz-select>

                        <label>C·∫•p d·ª± √°n</label>
                        <nz-select nzShowSearch nzAllowClear [(ngModel)]="dto.capDuAn" class="space-control">
                            <nz-option *ngFor="let i of capDuAn" [nzLabel]="i.name" [nzValue]="i.code"></nz-option>
                        </nz-select>

                        <label>Ph·ª• tr√°ch d·ª± √°n</label>
                        <nz-select nzShowSearch nzAllowClear [(ngModel)]="dto.phuTrachDuAn" class="space-control">
                            <nz-option *ngFor="let i of lstAccount" [nzLabel]="i.fullName"
                                [nzValue]="i.userName"></nz-option>
                        </nz-select>

                        <label>Qu·∫£n l√Ω h·ª£p ƒë·ªìng</label>
                        <nz-select nzShowSearch nzAllowClear [(ngModel)]="dto.quanLyHopDong" class="space-control">
                            <nz-option *ngFor="let i of lstAccount" [nzLabel]="i.fullName"
                                [nzValue]="i.userName"></nz-option>
                        </nz-select>

                        <label>Kh√°ch h√†ng</label>
                        <nz-select nzShowSearch nzAllowClear [(ngModel)]="dto.khachHang" class="space-control">
                            <nz-option *ngFor="let i of lstCustomer" [nzLabel]="i.name" [nzValue]="i.code"></nz-option>
                        </nz-select>

                        <div style="display: flex;gap:12px">
                            <div>
                                <label>Ng√†y b·∫Øt ƒë·∫ßu</label>
                                <nz-date-picker [(ngModel)]="dto.startDate" class="space-control"
                                    [nzFormat]="'dd/MM/yyyy'"></nz-date-picker>
                            </div>
                            <div>
                                <label>Ng√†y k·∫øt th√∫c</label>
                                <nz-date-picker [(ngModel)]="dto.endDate" class="space-control"
                                    [nzFormat]="'dd/MM/yyyy'"></nz-date-picker>
                            </div>
                        </div>

                        <label>Khu v·ª±c</label>
                        <input nz-input [(ngModel)]="dto.khuVuc" class="space-control" />

                        <label>ƒê·ªãa ƒëi·ªÉm</label>
                        <input nz-input [(ngModel)]="dto.diaDiem" class="space-control" />

                        <label>Ghi ch√∫</label>
                        <input nz-input [(ngModel)]="dto.notes" class="space-control" />
                    </div>

                </div>
            </div>
            <div nz-col class="gutter-row" [nzSpan]="12">
                <div class="inner-box">

                    <div nz-row [nzGutter]="12">
                        <div nz-col class="gutter-row" [nzSpan]="24">
                            <div class="inner-box">
                                <div class="project-file">
                                    <div class="file-upload-area" (click)="fileInput.click()">
                                        <div style="font-size: 36px;">üìÅ</div>
                                        <h3>T·∫£i l√™n file ƒë√≠nh k√®m d·ª± √°n</h3>
                                        <p style="color: #666; font-size: 14px;">H·ªó tr·ª£ c√°c ƒë·ªãnh d·∫°ng: PDF, DOC, DOCX,
                                            XLS, XLSX, PNG, JPG</p>
                                    </div>
                                </div>
                                <div *ngFor="let f of dto.files" class="file-item">
                                    <div><img [src]="f.icon" width="30" style="margin-right: 12px;"></div>
                                    <div>
                                        <span style="font-weight: 600;">{{f.fileName}}</span><br>
                                        <span style="font-size:12px; color: gray">{{ f.fileSize < 1048576 ? (f.fileSize
                                                / 1024 | number : "1.1-1" ) + " KB" : (f.fileSize / 1048576 | number
                                                : "1.1-1" ) + " MB" }}</span>
                                    </div>
                                    <div style="margin-left: auto;color: rgb(220, 53, 69);;">
                                        <nz-icon nzType="delete" nzTheme="outline" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div nz-col class="gutter-row" [nzSpan]="24">
                            <div class="inner-box">
                                <nz-tree #treeCom [nzData]="displayedConfigStructTree" nzBlockNode nzExpandAll
                                    [nzTreeTemplate]="nzTreeTemplate" [nzExpandedIcon]="multiExpandedIconTpl">
                                    <ng-template #nzTreeTemplate let-node>
                                        <div class="item-config-struct">
                                            <div>
                                                <nz-tag nzColor="default">{{node.origin.code}}</nz-tag>
                                                <span>{{ node.origin.name || node.title.split('_')[1] }}</span>
                                            </div>
                                        </div>
                                    </ng-template>
                                    <ng-template #multiExpandedIconTpl let-node let-origin="origin">
                                        <span *ngIf="node.children.length > 0" nz-icon style="font-size: 10px"
                                            [nzType]="node.isExpanded ? 'caret-down' : 'caret-right'"
                                            nzTheme="outline"></span>
                                    </ng-template>
                                </nz-tree>

                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </ng-container>

    <ng-template #extra>
        <nz-space>
            <button *nzSpaceItem nz-button nzType="primary" (click)="save()" class="btn-green">
                <nz-icon nzType="save" nzTheme="outline" /> L∆∞u
            </button>
            <button *nzSpaceItem nz-button nzType="primary" nzDanger (click)="close()">
                <nz-icon nzType="close" nzTheme="outline" />
            </button>
        </nz-space>
    </ng-template>
</nz-drawer>

<input type="file" #fileInput hidden multiple (change)="upload($event)" />